<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Preparing your data • rstickleback</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Preparing your data">
<meta property="og:description" content="rstickleback">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">rstickleback</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/how_stickleback_works.html">How Stickleback works</a>
</li>
<li>
  <a href="../articles/preparing-data.html">Preparing your data</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Preparing your data</h1>
            
      
      
      <div class="hidden name"><code>preparing-data.Rmd</code></div>

    </div>

    
    
<p>Examples in the <code>rstickleback</code> documentation rely on the <code><a href="../reference/load_lunges.html">load_lunges()</a></code> helper function to provide data in a processed format. Though convenient, <code><a href="../reference/load_lunges.html">load_lunges()</a></code> doesn’t help users understand how to prepare their own data. This vignette demonstrates the steps necessary to convert files in a directory to <code>rstickleback</code>-friendly objects. Your data won’t be in the same directory structure or follow the same naming conventions as these sample data, but hopefully this vignette gets you started in the right direction.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Start by loading a few packages, including rstickleback</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://fs.r-lib.org" class="external-link">fs</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lubridate.tidyverse.org" class="external-link">lubridate</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">rstickleback</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span>
<span class="co">#&gt; Warning: package 'readr' was built under R version 4.0.5</span></code></pre></div>
<div class="section level2">
<h2 id="starting-from-data-files">Starting from data files<a class="anchor" aria-label="anchor" href="#starting-from-data-files"></a>
</h2>
<p>The <a href="http://github.com/flukeandfeather/bluwhaledata" class="external-link">bluewhaledata</a> repository on GitHub has a zipped archive with the same sample data as this package, only in CSV form. The archive contains two directories, sensors and events, with CSV files containing bio-logging sensor data and behavioral event timestamps, respectively. For more details about how the data were collected and what they represent, see <code><a href="../reference/load_lunges.html">load_lunges()</a></code>.</p>
<p>You can download the data directly in R.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Create a temporary directory</span>
<span class="va">temp_dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>

<span class="co"># Download file and unzip data</span>
<span class="va">url</span> <span class="op">&lt;-</span> <span class="st">"https://github.com/FlukeAndFeather/bluewhaledata/raw/master/bluewhaledata.zip"</span>
<span class="fu"><a href="https://rdrr.io/r/utils/download.file.html" class="external-link">download.file</a></span><span class="op">(</span><span class="va">url</span>, <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">temp_dir</span>, <span class="st">"bluewhaledata.zip"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/unzip.html" class="external-link">unzip</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">temp_dir</span>, <span class="st">"bluewhaledata.zip"</span><span class="op">)</span>, exdir <span class="op">=</span> <span class="va">temp_dir</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="inspecting-the-data">Inspecting the data<a class="anchor" aria-label="anchor" href="#inspecting-the-data"></a>
</h2>
<p>Each CSV file is named according to the deployment identifier and data type (event or sensor).</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">data_dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">temp_dir</span>, <span class="st">"data"</span><span class="op">)</span>
<span class="co"># Note: your root folder won't match exactly. It's a random path, generated by</span>
<span class="co"># tempdir().</span>
<span class="fu"><a href="https://fs.r-lib.org/reference/dir_tree.html" class="external-link">dir_tree</a></span><span class="op">(</span><span class="va">data_dir</span><span class="op">)</span>
<span class="co">#&gt; <span style="color: #0000BB; font-weight: bold;">/var/folders/x2/pd2b41ls033f6_p4h4h37k880000gn/T//RtmpmEsyio/data</span></span>
<span class="co">#&gt; ├── <span style="color: #0000BB; font-weight: bold;">events</span></span>
<span class="co">#&gt; │   ├── bw180904-44_events.csv</span>
<span class="co">#&gt; │   ├── bw180904-48_events.csv</span>
<span class="co">#&gt; │   ├── bw180904-52_events.csv</span>
<span class="co">#&gt; │   ├── bw180905-42_events.csv</span>
<span class="co">#&gt; │   ├── bw180905-49_events.csv</span>
<span class="co">#&gt; │   └── bw180905-53_events.csv</span>
<span class="co">#&gt; └── <span style="color: #0000BB; font-weight: bold;">sensors</span></span>
<span class="co">#&gt;     ├── bw180904-44_sensors.csv</span>
<span class="co">#&gt;     ├── bw180904-48_sensors.csv</span>
<span class="co">#&gt;     ├── bw180904-52_sensors.csv</span>
<span class="co">#&gt;     ├── bw180905-42_sensors.csv</span>
<span class="co">#&gt;     ├── bw180905-49_sensors.csv</span>
<span class="co">#&gt;     └── bw180905-53_sensors.csv</span></code></pre></div>
<p>Inspecting the event and sensor data for the first deployment (identifier bw180904-44), we see that event CSV files have one datetime column, <code>lunge</code>, and sensor CSV files have five columns. In the sensor data, the <code>timestamp_utc</code> datetime column is the time and the other four columns (<code>depth</code>, <code>pitch</code>, <code>roll</code>, and <code>speed</code>) describe the animal’s movement.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sample_events</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">data_dir</span>, <span class="st">"events"</span>, <span class="st">"bw180904-44_events.csv"</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; <span style="font-weight: bold;">Rows: </span><span style="color: #0000BB;">40</span> <span style="font-weight: bold;">Columns: </span><span style="color: #0000BB;">1</span></span>
<span class="co">#&gt; <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Column specification</span> <span style="color: #00BBBB;">────────────────────────────────────────────────────────</span></span>
<span class="co">#&gt; <span style="font-weight: bold;">Delimiter:</span> ","</span>
<span class="co">#&gt; <span style="color: #0000BB;">dttm</span> (1): lunge</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Use `spec()` to retrieve the full column specification for this data.</span>
<span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Specify the column types or set `show_col_types = FALSE` to quiet this message.</span>
<span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="va">sample_events</span><span class="op">)</span>
<span class="co">#&gt; Rows: 40</span>
<span class="co">#&gt; Columns: 1</span>
<span class="co">#&gt; $ lunge <span style="color: #949494; font-style: italic;">&lt;dttm&gt;</span> 2018-09-04 10:52:19, 2018-09-04 10:54:15, 2018-09-04 10:56:08, …</span>
<span class="va">sample_sensors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">data_dir</span>, <span class="st">"sensors"</span>, <span class="st">"bw180904-44_sensors.csv"</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; <span style="font-weight: bold;">Rows: </span><span style="color: #0000BB;">72000</span> <span style="font-weight: bold;">Columns: </span><span style="color: #0000BB;">5</span></span>
<span class="co">#&gt; <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Column specification</span> <span style="color: #00BBBB;">────────────────────────────────────────────────────────</span></span>
<span class="co">#&gt; <span style="font-weight: bold;">Delimiter:</span> ","</span>
<span class="co">#&gt; <span style="color: #00BB00;">dbl</span>  (4): depth, pitch, roll, speed</span>
<span class="co">#&gt; <span style="color: #0000BB;">dttm</span> (1): timestamp_utc</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Use `spec()` to retrieve the full column specification for this data.</span>
<span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Specify the column types or set `show_col_types = FALSE` to quiet this message.</span>
<span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="va">sample_sensors</span><span class="op">)</span>
<span class="co">#&gt; Rows: 72,000</span>
<span class="co">#&gt; Columns: 5</span>
<span class="co">#&gt; $ timestamp_utc <span style="color: #949494; font-style: italic;">&lt;dttm&gt;</span> 2018-09-04 10:47:16, 2018-09-04 10:47:16, 2018-09-04 10…</span>
<span class="co">#&gt; $ depth         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.3480302, 0.3534735, 0.3587432, 0.3638423, 0.3683940, 0…</span>
<span class="co">#&gt; $ pitch         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> -0.276757371, -0.253706385, -0.232672562, -0.212183548, …</span>
<span class="co">#&gt; $ roll          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.34689666, 0.29694713, 0.24615438, 0.19446428, 0.141366…</span>
<span class="co">#&gt; $ speed         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 6.297395, 6.110192, 5.890096, 5.673690, 5.456957, 5.2420…</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="preparing-the-data">Preparing the data<a class="anchor" aria-label="anchor" href="#preparing-the-data"></a>
</h2>
<p>To prepare these data for use in <code>rstickleback</code>, we have to combine all the CSVs into two data frames; one each for events and sensors. Here is one way of doing that using a for-loop, which is likely familiar to most readers. I demonstrate a more elegant solution later.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># A list of the deployment ids</span>
<span class="va">deployids</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"bw180904-44"</span>,
              <span class="st">"bw180904-48"</span>,
              <span class="st">"bw180904-52"</span>,
              <span class="st">"bw180905-42"</span>,
              <span class="st">"bw180905-49"</span>,
              <span class="st">"bw180905-53"</span><span class="op">)</span>

<span class="co"># Create empty data frames to hold the results</span>
<span class="va">bw_events_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">bw_sensors_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="op">)</span>

<span class="co"># Iterate through the deployment ids, read the data, and append to the results</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">id</span> <span class="kw">in</span> <span class="va">deployids</span><span class="op">)</span> <span class="op">{</span>
  <span class="co"># Event data first...</span>
  <span class="va">event_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">dir</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">data_dir</span>, <span class="st">"events"</span><span class="op">)</span>, 
                    pattern <span class="op">=</span> <span class="va">id</span>, 
                    full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
  <span class="va">events</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="va">event_path</span>, col_types <span class="op">=</span> <span class="st">"T"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
    <span class="co"># I happen to know dates are in UTC. Metadata are important!</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>lunge <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/force_tz.html" class="external-link">force_tz</a></span><span class="op">(</span><span class="va">lunge</span>, <span class="st">"UTC"</span><span class="op">)</span>,
           deployid <span class="op">=</span> <span class="va">id</span><span class="op">)</span>
  <span class="va">bw_events_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">bw_events_df</span>, <span class="va">events</span><span class="op">)</span>
  <span class="co"># ...then sensor data</span>
  <span class="va">sensor_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">dir</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">data_dir</span>, <span class="st">"sensors"</span><span class="op">)</span>, 
                     pattern <span class="op">=</span> <span class="va">id</span>, 
                     full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
  <span class="co"># Specifying the column types with the `col_types` parameter suppresses a lot</span>
  <span class="co"># of extraneous messages about column parsing.</span>
  <span class="va">sensors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="va">sensor_path</span>, col_types <span class="op">=</span> <span class="st">"Tdddd"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>timestamp_utc <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/force_tz.html" class="external-link">force_tz</a></span><span class="op">(</span><span class="va">timestamp_utc</span>, <span class="st">"UTC"</span><span class="op">)</span>,
           deployid <span class="op">=</span> <span class="va">id</span><span class="op">)</span>
  <span class="va">bw_sensors_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">bw_sensors_df</span>, <span class="va">sensors</span><span class="op">)</span>
<span class="op">}</span>

<span class="co"># The results</span>
<span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="va">bw_events_df</span><span class="op">)</span>
<span class="co">#&gt; Rows: 218</span>
<span class="co">#&gt; Columns: 2</span>
<span class="co">#&gt; $ lunge    <span style="color: #949494; font-style: italic;">&lt;dttm&gt;</span> 2018-09-04 10:52:19, 2018-09-04 10:54:15, 2018-09-04 10:56:0…</span>
<span class="co">#&gt; $ deployid <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "bw180904-44", "bw180904-44", "bw180904-44", "bw180904-44", "…</span>
<span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="va">bw_sensors_df</span><span class="op">)</span>
<span class="co">#&gt; Rows: 416,046</span>
<span class="co">#&gt; Columns: 6</span>
<span class="co">#&gt; $ timestamp_utc <span style="color: #949494; font-style: italic;">&lt;dttm&gt;</span> 2018-09-04 10:47:16, 2018-09-04 10:47:16, 2018-09-04 10…</span>
<span class="co">#&gt; $ depth         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.3480302, 0.3534735, 0.3587432, 0.3638423, 0.3683940, 0…</span>
<span class="co">#&gt; $ pitch         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> -0.276757371, -0.253706385, -0.232672562, -0.212183548, …</span>
<span class="co">#&gt; $ roll          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.34689666, 0.29694713, 0.24615438, 0.19446428, 0.141366…</span>
<span class="co">#&gt; $ speed         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 6.297395, 6.110192, 5.890096, 5.673690, 5.456957, 5.2420…</span>
<span class="co">#&gt; $ deployid      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "bw180904-44", "bw180904-44", "bw180904-44", "bw180904-4…</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="creating-rstickleback-friendly-objects">Creating <code>rstickleback</code>-friendly objects<a class="anchor" aria-label="anchor" href="#creating-rstickleback-friendly-objects"></a>
</h2>
<p>We now have two data frames containing all the event and sensor data for these six deployments, which we can use to create <code>Event</code> and <code>Sensor</code> objects for use with <code>rstickleback</code>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">bw_events</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Events.html">Events</a></span><span class="op">(</span><span class="va">bw_events_df</span>, 
                    deployid_col <span class="op">=</span> <span class="st">"deployid"</span>, 
                    datetime_col <span class="op">=</span> <span class="st">"lunge"</span><span class="op">)</span>
<span class="va">bw_sensors</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Sensors.html">Sensors</a></span><span class="op">(</span><span class="va">bw_sensors_df</span>,
                      deployid_col <span class="op">=</span> <span class="st">"deployid"</span>,
                      datetime_col <span class="op">=</span> <span class="st">"timestamp_utc"</span>, 
                      sensor_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"depth"</span>, <span class="st">"pitch"</span>, <span class="st">"roll"</span>, <span class="st">"speed"</span><span class="op">)</span><span class="op">)</span>

<span class="va">bw_events</span>
<span class="co">#&gt; Events</span>
<span class="co">#&gt;   6 deployments.</span>
<span class="co">#&gt;   With 218 events.</span>
<span class="va">bw_sensors</span>
<span class="co">#&gt; Sensors</span>
<span class="co">#&gt;   6 deployments.</span>
<span class="co">#&gt;   With column(s): depth, pitch, roll, speed</span></code></pre></div>
<p>These data are now ready to use with <code>rstickleback</code> functions. For example, you can visualize the event and sensor data with <code><a href="../reference/sb_plot.html">sb_plot_data()</a></code> and train a model using <code><a href="../reference/sb_fit.html">sb_fit()</a></code>.</p>
</div>
<div class="section level2">
<h2 id="a-more-elegant-solution">A more elegant solution<a class="anchor" aria-label="anchor" href="#a-more-elegant-solution"></a>
</h2>
<p>As a final note, here’s the more elegant way to read an entire directory of CSVs using regular expressions to extract the deployment identifier from the file name. Note: this only works if your version of <code>readr</code> is at least 2.0.0.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">event_csvs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">dir</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">data_dir</span>, <span class="st">"events"</span><span class="op">)</span>, full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="va">bw_events_df2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="va">event_csvs</span>, col_types <span class="op">=</span> <span class="st">"T"</span>, id <span class="op">=</span> <span class="st">"file_name"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>deployid <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html" class="external-link">str_extract</a></span><span class="op">(</span><span class="va">file_name</span>, <span class="st">"bw[0-9]{6}-[0-9]{2}"</span><span class="op">)</span><span class="op">)</span>
<span class="va">sensor_csvs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">dir</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">data_dir</span>, <span class="st">"sensors"</span><span class="op">)</span>, full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="va">bw_sensors_df2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="va">sensor_csvs</span>, col_types <span class="op">=</span> <span class="st">"T"</span>, id <span class="op">=</span> <span class="st">"file_name"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>deployid <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html" class="external-link">str_extract</a></span><span class="op">(</span><span class="va">file_name</span>, <span class="st">"bw[0-9]{6}-[0-9]{2}"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>These data frames are functionally equivalent to those made with the for-loop, and work just as well with <code>rstickleback</code> functions.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">bw_events2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Events.html">Events</a></span><span class="op">(</span><span class="va">bw_events_df2</span>, 
                     deployid_col <span class="op">=</span> <span class="st">"deployid"</span>, 
                     datetime_col <span class="op">=</span> <span class="st">"lunge"</span><span class="op">)</span>
<span class="va">bw_sensors2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Sensors.html">Sensors</a></span><span class="op">(</span><span class="va">bw_sensors_df2</span>,
                       deployid_col <span class="op">=</span> <span class="st">"deployid"</span>,
                       datetime_col <span class="op">=</span> <span class="st">"timestamp_utc"</span>, 
                       sensor_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"depth"</span>, <span class="st">"pitch"</span>, <span class="st">"roll"</span>, <span class="st">"speed"</span><span class="op">)</span><span class="op">)</span>

<span class="va">bw_events2</span>
<span class="co">#&gt; Events</span>
<span class="co">#&gt;   6 deployments.</span>
<span class="co">#&gt;   With 218 events.</span>
<span class="va">bw_sensors2</span>
<span class="co">#&gt; Sensors</span>
<span class="co">#&gt;   6 deployments.</span>
<span class="co">#&gt;   With column(s): depth, pitch, roll, speed</span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Max Czapanskiy.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.3.9000.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
